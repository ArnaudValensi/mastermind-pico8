pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
speed = 2
btn_sprs={8,9,10,11}

playerx=32
playery=32
shaking=0
shakex=0
shakey=0
map_off_x=20
map_off_y=16
secret={}
round=0
guesses={{1,1,1,1}}
closet_btn=nil
trig_dist=8

t=0
function draw_bg()
 t+=0.02
 
 for i=0,1000 do
  local x,y=rnd(128),rnd(128)
  local c=(x/16+y/32+t)%6+8
  circfill(x,y,1,c)
 end
end

function _init()
	cls()
	camera(0,0)
	
	secret[1]=rnd(4)
	secret[2]=rnd(4)
	secret[3]=rnd(4)
	secret[4]=rnd(4)
end

function check_btn_dist()
	for i=1,5 do
	 local btnx=i*8+map_off_x
	 local btny=(round+1)*8+map_off_y
	 
	 if abs(playerx-btnx)<trig_dist 
	 and abs(playery-btny)<trig_dist
	 then
	 	closet_btn=i-1
	 	return
	 end
	end
	
	closet_btn=nil
end

function check_row()
 local row=round+1
 local guess=guesses[row]
	local valid=true
	
	valid=valid and secret[1]==guess[1]
 //valid=valid and secret[2]==guess[2]	
 
 printh(secret[1])
 if valid == false then
  shaking=30
 end
end

function handla_action()
 if closet_btn == nil then
  return
 elseif closet_btn == 4 then
  check_row()
 else
  local row=round+1
  local idx=guesses[row][closet_btn+1]
  guesses[row][closet_btn+1]=
   idx%#btn_sprs+1
 end
end

function _update()
	if btn(‚û°Ô∏è) then
		playerx=playerx+speed
	end
	if btn(‚¨ÖÔ∏è) then
		playerx=playerx-speed
	end
	if btn(‚¨ÜÔ∏è) then
		playery=playery-speed
	end
	if btn(‚¨áÔ∏è) then
		playery=playery+speed
	end
	if btnp(üÖæÔ∏è) then
	 handla_action()
	end
	
	if shaking > 0 then
		shaking-=1
		shakex=rnd(10)-5
		shakey=rnd(10)-5
		if shaking == 0 then
			shakex=0
			shakey=0
		end
		
		map_off_x=20+shakex
		map_off_y=16+shakey
	end
	
 check_btn_dist()
end

function print_top(str,x,y)
	draw_text(
	 str,
	 map_off_x+x*8,
	 map_off_y+y*8-4,7
	)
end

function draw_btns()
 local row=round+1
 for i=1,4 do
  local btn_spr=
   btn_sprs[guesses[row][i]]
  
  spr(
   btn_spr,
   i*8+map_off_x,
   (round+1)*8+map_off_y
  )
 end
end

function _draw()
 draw_bg()
	map(
	 0,0,
	 map_off_x,
	 map_off_y,
	 12,12
	)
		
	draw_btns()
	
	//player
	spr(
	 1,
	 playerx+shakex,
	 playery+shakey
	)

 //display btn hint
 if closet_btn != nil then
 	print_top(
 	 "press üÖæÔ∏è",
 	 closet_btn+1,
 	 round+1,
 	 0
 	)
 end
end

function draw_text(str,x,y,al,extra,c1,c2)
    str = ""..str
    local al = al or 1
    local c1 = c1 or 7
    local c2 = c2 or 13

    if al == 1 then x -= #str * 2 - 1
    elseif al == 2 then x -= #str * 4 end

    y -= 3

    if extra then
        print(str,x,y+3,0)
        print(str,x-1,y+2,0)
        print(str,x+1,y+2,0)
        print(str,x-2,y+1,0)
        print(str,x+2,y+1,0)
        print(str,x-2,y,0)
        print(str,x+2,y,0)
        print(str,x-1,y-1,0)
        print(str,x+1,y-1,0)
        print(str,x,y-2,0)
    end

    print(str,x+1,y+1,c2)
    print(str,x-1,y+1,c2)
    print(str,x,y+2,c2)
    print(str,x+1,y,c1)
    print(str,x-1,y,c1)
    print(str,x,y+1,c1)
    print(str,x,y-1,c1)
    print(str,x,y,0)
end

__gfx__
00000000555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555500000000
000000005655566555665555558888555566665577777757555555555555555555588555555aa555555cc555555bb55555555555555555555555555500000000
00700700566666555655566558888885566663656666665654555555555555555588885555aaaa5555cccc5555bbbb5555555555555555555555555500000000
00077000565656555666665558888885563636656666665655555555555555555588885555aaaa5555cccc5555bbbb55555bb555555775555558855500000000
000770005666665556565655588888855663666555555555555455555555555555288255559aa95555dccd55553bb355555bb555555775555558855500000000
007007005666665556666655528888255d6666d57775777755555555555555555552255555599555555dd5555553355555555555555555555555555500000000
0000000056666655566666555522225555dddd556665666655555555555555555555555555555555555555555555555555555555555555555555555500000000
00000000565556555655565555555555555555556665666655555555555555555555555555555555555555555555555555555555555555555555555500000000
__map__
0505050505050505050505000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0507070707040c0c0d0e05000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0506070707070707070705000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0507070707070707070705000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0507070706070707070705000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0507070707070707070705000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0507070707060707070705000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0507070707070707070705000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0507070707070707070605000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0507070707070707070705000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0506070707070707070705000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
